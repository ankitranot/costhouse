<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> Cost of Construction</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <style>
    body {
      font-family:"Segoe UI",sans-serif;
      margin:0;
      padding:0;
      background:#fafafa;
      color:#111;
      font-size:17px;
    }
    header {
      background:#FFFFFF;
      color:#000;
      padding:35px;
      text-align:center;
      font-size:65px;
      font-weight:bold;
    }
    .container {
      max-width:1000px;
      margin:30px auto;
      background:#fff;
      padding:30px;
      border-radius:10px;
      box-shadow:0 3px 8px rgba(0,0,0,0.1);
    }
    .form-group {
      display:flex;
      flex-wrap:wrap;
      margin-bottom:15px;
      gap:10px;
    }
    .form-group input, .form-group select {
      flex:1;
      padding:12px;
      border:1px solid #aaa;
      border-radius:8px;
      font-size:17px;
      background:#fff;
      color:#111;
    }
    button {
      background:#000;
      color:#fff;
      border:none;
      padding:10px 10px;
      border-radius:8px;
      cursor:pointer;
      font-size:15px;
    }
    
    .summary-box {
      background:#222;
      color:white;
      padding:18px;
      border-radius:12px;
      margin-bottom:20px;
      text-align:center;
      font-size:20px;
      font-weight:bold;
    }
    table {
      width:100%;
      border-collapse:collapse;
      margin-top:20px;
      font-size:16px;
    }
    th,td {
      border:1px solid #ccc;
      padding:12px;
      text-align:center;
    }
    th {
      background:#000;
      color:white;
      font-size:16px;
    }
    tr:nth-child(even){
      background:#f4f4f4;
    }
    .history {
      font-size:15px;
      color:#444;
      text-align:left;
    }
    .export-buttons {
      margin-top:20px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
    }
    .export-buttons button {
      flex:1;
      min-width:140px;
    }
    @media(max-width:768px){
      .form-group{flex-direction:column;}
      th,td{font-size:15px;padding:10px;}
      .summary-box{font-size:18px;padding:15px;}
      button{width:100%;}
    }
  </style>
</head>
<body>
  <header> Cost of Construction</header>
  <div class="container">
    <div class="summary-box">Total Amount: <span id="grandTotal">0</span></div>

    <div class="form-group">
      <input type="text" id="material" placeholder="Material / Item">
      <input type="text" id="person" placeholder="Person Name">
      <input type="number" id="cost" placeholder="Total Cost">
      <input type="number" id="paid" placeholder="Amount Paid">
      <button onclick="addRecord()">Add</button>
    </div>

    <div class="form-group">
      <label for="personFilter"><b>Filter by Person:</b></label>
      <select id="personFilter" onchange="renderTable()"><option value="">All</option></select>
    </div>

    <table id="recordsTable">
      <thead>
        <tr>
          <th>Date</th><th>Material</th><th>Person</th>
          <th>Total Cost</th><th>Paid</th><th>Left</th>
          <th>History</th><th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

   

<script>
// ---------------- Firebase Setup ----------------
const firebaseConfig = {
  apiKey: "AIzaSyBV7tHimRYOI-zEN-4eythyPc39bafLHVY",
  authDomain: "costhouse25.firebaseapp.com",
  projectId: "costhouse25",
  storageBucket: "costhouse25.firebasestorage.app",
  messagingSenderId: "1031854363789",
  appId: "1:1031854363789:web:2db3e48f1c774a12297ec4"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ---------------- Local Records ----------------
let records=[];

// ---------------- Add Record ----------------
async function addRecord(){
  const material=document.getElementById("material").value;
  const person=document.getElementById("person").value;
  const cost=parseFloat(document.getElementById("cost").value)||0;
  const paid=parseFloat(document.getElementById("paid").value)||0;
  if(!material||!person||cost<=0){alert("Please fill material, person, and cost.");return;}
  const date=new Date().toLocaleDateString();
  const record={date,material,person,totalCost:cost,amountPaid:paid,
    history:[{date,added:paid}]};
  await db.collection("constructionRecords").add(record);
  document.getElementById("material").value="";
  document.getElementById("person").value="";
  document.getElementById("cost").value="";
  document.getElementById("paid").value="";
}

// ---------------- Load Records Live ----------------
db.collection("constructionRecords").onSnapshot(snapshot=>{
  records = snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));
  updatePersonFilter();
  renderTable();
});

// ---------------- Filter Persons ----------------
function updatePersonFilter(){
  const filter=document.getElementById("personFilter");
  const persons=[...new Set(records.map(r=>r.person))];
  filter.innerHTML='<option value="">All</option>';
  persons.forEach(p=>{
    const opt=document.createElement("option");
    opt.value=p; opt.textContent=p;
    filter.appendChild(opt);
  });
}

// ---------------- Render Table ----------------
function renderTable(){
  const tbody=document.querySelector("#recordsTable tbody");tbody.innerHTML="";
  const filterPerson=document.getElementById("personFilter").value;
  let total=0;
  records.filter(r=>!filterPerson||r.person===filterPerson).forEach((r)=>{
    const tr=document.createElement("tr");
    const left=r.totalCost-r.amountPaid; total+=r.totalCost;
    const historyHTML = r.history.map(h=>`<div>${h.date} â†’ +${h.added}</div>`).join("");
    tr.innerHTML=`
      <td>${r.date}</td><td>${r.material}</td><td>${r.person}</td>
      <td>${r.totalCost}</td><td>${r.amountPaid}</td><td>${left===0?"Nill":left}</td>
      <td class="history">${historyHTML}</td>
      <td>
        <button onclick="updatePaid('${r.id}')">Update Paid</button>
        <button onclick="deleteRecord('${r.id}')">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
  document.getElementById("grandTotal").textContent=total;
}

// ---------------- Update Paid ----------------
async function updatePaid(id){
  const add=parseFloat(prompt("Enter additional amount paid:"))||0;if(add<=0)return;
  const date=new Date().toLocaleDateString();
  const record=records.find(r=>r.id===id);
  const newPaid=record.amountPaid+add;
  const newHistory=[...record.history,{date,added:add}];
  await db.collection("constructionRecords").doc(id).update({
    amountPaid:newPaid,history:newHistory
  });
}

// ---------------- Delete Record ----------------
async function deleteRecord(id){
  if(confirm("Delete this record?")){
    await db.collection("constructionRecords").doc(id).delete();
  }
}

// ---------------- Totals ----------------
function getTotals(filteredRecords){
  let total=0,paid=0,left=0;
  filteredRecords.forEach(r=>{total+=r.totalCost;paid+=r.amountPaid;left+=r.totalCost-r.amountPaid;});
  return {total,paid,left};
}




</script>
</body>
</html>
